<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>StudentTaskTracker</title>
<style>
  body, html { margin:0; padding:0; width:100%; height:100%; overflow:auto; font-family:'Montserrat', sans-serif; background: linear-gradient(135deg, #2d1b4f, #831c98, #4f1c65, #201040); color:#e2e8f0; }
  header { position: fixed; top:0; left:0; width:100%; display:flex; align-items:center; justify-content:space-between; padding:15px 40px; z-index:50; background: rgba(25, 10, 45, 0.6); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); }
  .search-container { flex:1; display:flex; justify-content:center; align-items:center; }
  .search-box { display:flex; align-items:center; width:400px; background: rgba(255,255,255,0.1); border-radius:25px; padding:8px 15px; }
  .search-box input { flex:1; background:transparent; border:none; outline:none; color:#f1f5f9; font-size:16px; }
  .search-box input::placeholder { color:#a5a5a5; }
  .search-box img { width:22px; height:22px; margin-right:10px; filter:brightness(0) invert(1); }
  .about-link, .contact-link { color:#f1f5f9; text-decoration:none; font-weight:600; font-size:17px; padding:8px 15px; border-radius:20px; background: rgba(60, 45, 90,0.5); transition: all 0.3s ease; }
  .about-link:hover, .contact-link:hover { background: linear-gradient(90deg,#b980ff,#a855f7); box-shadow:0 0 12px rgba(168,85,247,0.5); color:#fff; }
  .contact-link { margin-right:70px; } .about-link { margin-right:10px; }

  .dashboard { position:fixed; top:140px; left:25px; width:280px; padding:16px; background: rgba(255,255,255,0.1); border-radius:20px; backdrop-filter: blur(20px); box-shadow:0 4px 20px rgba(0,0,0,0.3); }
  .dash-btn { display:flex; align-items:center; justify-content:center; width:85%; height:50px; margin:10px auto; border-radius:12px; background: linear-gradient(135deg,#5b21b6,#9333ea); color:white; font-weight:600; cursor:pointer; transition:transform 0.3s ease; }
  .dash-btn:hover { transform: scale(1.05); }
  .dash-btn a {
  color: inherit;
  text-decoration: none;
  display: block;
  width: 100%;
  height: 100%;
  text-align: center;
  line-height: 50px;
}


  .board { margin-left:340px; margin-top:120px; display:flex; gap:25px; padding:20px; }
  .column { background: rgba(255,255,255,0.1); backdrop-filter:blur(20px); border-radius:16px; padding:15px; width:280px; min-height:400px; display:flex; flex-direction:column; }
  .column h3 { text-align:center; margin-bottom:10px; }
  .task { display:flex; justify-content:space-between; align-items:center; background: linear-gradient(135deg,#4338ca,#6d28d9); color:#fff; padding:12px; border-radius:10px; margin:8px 0; font-weight:600; cursor:grab; transition:transform 0.2s ease; }
  .task:hover { transform: scale(1.03); } .task:active { cursor:grabbing; }
  .add-task-btn { margin-top:auto; padding:8px; background: rgba(255,255,255,0.2); color:white; border-radius:8px; text-align:center; cursor:pointer; font-weight:600; }
  .add-task-btn:hover { background: rgba(255,255,255,0.4); }

  /* Delete button */
  .delete-task {
    display:inline-flex; align-items:center; justify-content:center;
    width:22px; height:22px; background:#ff4d4d; border-radius:50%; color:#fff;
    font-weight:bold; cursor:pointer; font-size:14px; margin-left:10px; transition: transform 0.2s ease;
  }
  .delete-task:hover { transform: scale(1.2); background:#ff1a1a; }
</style>
</head>
<body>

<header>
  <div class="search-container">
    <div class="search-box">
      <img src="{{ url_for('static', filename='images/search-icon.svg') }}" alt="Search">
      <input type="text" placeholder="Search tasks...">
    </div>
  </div>
  <a href="{{ url_for('about') }}" class="about-link">About</a>
  <a href="{{ url_for('contact') }}" class="contact-link">Contact</a>
</header>

<div class="dashboard">
  <div class="dash-btn" id="newBoardBtn">+ New Board</div>
  <div class="dash-btn"><a href="{{ url_for('archive') }}">üì¶ Archive</a></div>  
  <div class="dash-btn"><a href="{{ url_for('trash') }}">üóë Trash</a></div>
  <div class="dash-btn">‚öô Settings</div>
</div>

<div class="board">
  {% for status, tasks, icon in [
    ("todo", todo, "üìù To Do"),
    ("in_progress", in_progress, "üîÑ In Progress"),
    ("completed", completed, "‚úÖ Completed")
  ] %}
  <div class="column" id="{{ status }}">
    <h3>{{ icon }}</h3>
    {% for task in tasks %}
      <div class="task" draggable="true" data-id="{{ task.id }}" data-status="{{ status }}">
        <span class="task-desc">{{ task.description }}</span>
        <span class="delete-task">√ó</span>
      </div>
    {% endfor %}
    <div class="add-task-btn" data-status="{{ status }}">+ Add Task</div>
  </div>
  {% endfor %}
</div>

<script>
const boardId = {{ board_id }};

// Drag & Drop
function makeTasksDraggable() {
  document.querySelectorAll('.task').forEach(task => {
    task.addEventListener('dragstart', () => task.classList.add('dragging'));
    task.addEventListener('dragend', () => task.classList.remove('dragging'));
  });
}
makeTasksDraggable();

document.querySelectorAll('.column').forEach(column => {
  column.addEventListener('dragover', e => e.preventDefault());
  column.addEventListener('drop', e => {
    e.preventDefault();
    const dragging = document.querySelector('.dragging');
    if(!dragging) return;
    column.insertBefore(dragging, column.querySelector('.add-task-btn'));
    fetch('/move_task', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({id: dragging.dataset.id, to: column.id})
    });
    dragging.dataset.status = column.id;
  });
});

// Add Task
document.querySelectorAll('.add-task-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const status = btn.dataset.status;
    const description = prompt("Enter task description:");
    if(!description) return;

    fetch('/add_task', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({board_id: boardId, description, status})
    })
    .then(res => res.json())
    .then(data => {
      const newTask = document.createElement('div');
      newTask.classList.add('task');
      newTask.draggable = true;
      newTask.dataset.id = data.inserted_id || "temp";
      newTask.dataset.status = status;

      newTask.innerHTML = `<span class="task-desc">${description}</span>
                           <span class="delete-task">√ó</span>`;

      btn.parentNode.insertBefore(newTask, btn);
      makeTasksDraggable();
      attachDeleteEvent(newTask.querySelector('.delete-task'));
    });
  });
});

// Attach delete event
function attachDeleteEvent(deleteBtn) {
  deleteBtn.addEventListener('click', e => {
    const taskDiv = e.target.parentElement;
    const taskId = taskDiv.dataset.id;

    fetch('/delete_task', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({id: taskId})
    }).then(() => taskDiv.remove());
  });
}

// Initial delete events
document.querySelectorAll('.delete-task').forEach(btn => attachDeleteEvent(btn));

// New Board
document.getElementById('newBoardBtn').addEventListener('click', () => {
  if(confirm("Archive current board and create a new one?")) {
    fetch('/new_board', { method:'POST' })
      .then(res => res.json())
      .then(data => {
        alert("Board archived and new board created!");
        location.reload();
      });
  }
});
</script>

</body>
</html>
